'''
Created on Jan 3, 2013

@author: chunwei
'''
from sets import Set
import common
import os

class IDTranser:
    '''
    parse all trainingset and find all userid in a set
    then sort the set and output to a file
    '''
    def __init__(self, dir='~/NetFlixData/training_set', outpath='~/NetFlixData/training_set/userids.red'):
        self.set = Set()
        self._dir = dir
        self._outpath = outpath
        self._list = None
    
    def load(self):
        files = os.listdir(self._dir)
        for f in files:
            path = os.path.join(self._dir, f)
            f = open(path)
            content = f.read()
            yield content
            f.close()
    
    def parse(self):
        for i,c in enumerate(self.load()):
            lines = c.split('\n')
            for l in lines:
                print '.. the movie ID'
                if len(l.split(',')) < 3: continue
                if common.canfind(l, ':'): continue
                # the line contains userid
                words = l.split()
                userid = words[0]
                self.set.add(int(userid))
            if i % 100:
                print '.. has parsed %d files' % i
        print '.. begin sort ids'
        print '.. get list'
        self._list = list(self.set)
        print '.. list sort'
        self._list.sort()
        print '.. end parse.'
    
    def tofile(self):
        f = open(self._outpath, 'a')
        f.writelines([str(s) for s in self._list])
        print '.. succeed output to file : <%s>' % self._outpath
            
if __name__ == '__main__':
    idname =  IDTranser()
    idname.parse()
    idname.tofile()
     